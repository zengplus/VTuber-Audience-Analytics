# VTuber-Audience-Analytics

> 基于 DuckDB + Streamlit 的 VTuber 观众流动与聚类分析小工具

---

## 一键运行

1. 克隆并进入仓库  
   ```bash
   git clone https://github.com/zengplus/VTuber-Audience-Analytics.git
   cd VTuber-Audience-Analytics
   ```

2. 安装依赖 
   ```bash
   pip install -r requirements.txt
   ```

3. 下载样本数据（**首次**）  
3.1 下载样本数据（**首次**） 
   ```bash
   mkdir -p data
   curl -L -o data/fans_events.parquet \
     https://github.com/zengplus/VTuber-Audience-Analytics/releases/download/v1.0/fans_events.parquet
   ```

3.2 下载样本数据（**首次**） 
   ```bash
   git lfs install
   git clone https://github.com/zengplus/VTuber-Audience-Analytics.git
   cd VTuber-Audience-Analytics
   ```
   > 已有完整数据可跳过，直接放 `data/fans_events.parquet`

4. 启动  
   ```bash
   streamlit run app.py
   ```
   浏览器自动打开 http://localhost:8501

---

## 目录结构

```
.
├── app.py                 # 主入口
├── modules/               # 子页面模块
│   ├── matrix.py
│   ├── trend.py
│   ├── cluster.py
│   ├── assoc.py
│   └── update.py
├── data/
│   └── fans_events.parquet      # 观众观看事件（LFS 托管）
├── mydb.duckdb            # 本地 DuckDB（自动生成，git 忽略）
├── analysis.sql           # 数仓建模 SQL
├── requirements.txt       # Python 依赖
└── README.md              # 本文件
```

---

## 技术栈

| 工具        | 用途                     |
|-------------|--------------------------|
| DuckDB      | 本地 OLAP 与 SQL 转换    |
| Streamlit   | 前端交互与可视化         |
| Git LFS     | 大文件存储（>100 MB）    |
| Pandas      | 轻量 ETL                 |
| Scikit-learn| 聚类 / PCA               |

---

## 功能速览

1. **用户流动矩阵**  
   每月从谁→谁流入了多少观众，热力图 + 表格双视图。
2. **月度趋势**  
   新增 vs 流失折线，可多选主播对比。
3. **增量更新**  
   拉取官方 API 最新关注记录，自动合并到 `fans_events.parquet`。
4. **观众聚类**  
   按观看行为把用户聚成 N 类，PCA 降维可视化。
5. **兴趣关联**  
   喜欢 A 的主播观众，还喜欢谁？Top-N 饼图。

---

## 数据源

- 主数据：`fans_events.parquet`（uid, liver, ts）  
- 维度表：`id2name.py` 内置 40+ 位主播映射  
- 增量接口：https://danmakus.com/api/v2/user/watchedChannels  
  需要自行申请/限频，默认 1 次/秒。




